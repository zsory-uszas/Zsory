<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 Miskolci √ösz√≥verseny - √âl≈ë Eredm√©nyek</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --gold: #FFD700;
            --silver: #C0C0C0;
            --bronze: #CD7F32;
            --background: #1a1a2e;
            --card-bg: #16213e;
            --text: #ffffff;
            --accent: #0fccce;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --event: #e94560;
            --miskolc-blue: #1e88e5;
            --miskolc-red: #e53935;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: var(--text);
            line-height: 1.6;
            padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--miskolc-blue) 0%, #1565c0 100%);
            padding: 25px 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            position: relative;
            z-index: 10;
            border-bottom: 5px solid var(--miskolc-red);
        }
        
        .logo {
            font-size: 2.2rem;
            font-weight: bold;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .logo::before {
            content: "üèä‚Äç‚ôÇÔ∏è";
            margin-right: 15px;
            font-size: 2.5rem;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
        }
        
        .subtitle {
            font-size: 1.4rem;
            color: white;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .year {
            font-size: 1.1rem;
            color: #ffeb3b;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .live-indicator {
            display: inline-flex;
            align-items: center;
            background: var(--success);
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: bold;
            animation: pulse 2s infinite;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .live-indicator::before {
            content: "üî¥";
            display: inline-block;
            margin-right: 8px;
            animation: blink 1.5s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: linear-gradient(135deg, var(--miskolc-blue) 0%, #1976d2 100%);
            padding: 20px;
            margin: 25px auto;
            max-width: 1200px;
            border-radius: 15px;
            border: 2px solid var(--miskolc-red);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .stat-label {
            font-size: 1rem;
            color: #e3f2fd;
            margin-top: 8px;
            font-weight: 500;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
        }
        
        @media (min-width: 768px) {
            .container {
                grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            }
        }
        
        .swimmer-card {
            background: linear-gradient(145deg, #16213e 0%, #1a1a2e 100%);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            padding: 25px;
            margin-bottom: 20px;
            border: 2px solid var(--miskolc-blue);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .swimmer-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--miskolc-blue), var(--miskolc-red));
        }
        
        .swimmer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.7);
            border-color: var(--miskolc-red);
        }
        
        .swimmer-name {
            font-weight: bold;
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--miskolc-blue);
            display: flex;
            align-items: center;
            text-shadow: 0 0 10px rgba(30, 136, 229, 0.3);
        }
        
        .swimmer-name::before {
            content: "üë§";
            margin-right: 10px;
            font-size: 1.8rem;
        }
        
        .event-group {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(229, 57, 53, 0.1);
            border-radius: 10px;
            border-left: 4px solid var(--miskolc-red);
        }
        
        .event-name {
            font-weight: bold;
            color: var(--miskolc-red);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            font-size: 1.1rem;
        }
        
        .event-name::before {
            content: "üèÖ";
            margin-right: 8px;
        }
        
        .placement-list {
            margin-left: 10px;
        }
        
        .placement-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .placement-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
        
        .medal {
            display: inline-block;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            margin-right: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
            position: relative;
        }
        
        .medal::after {
            content: "";
            position: absolute;
            top: 4px;
            left: 4px;
            right: 4px;
            bottom: 4px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
        }
        
        .gold {
            background: linear-gradient(135deg, var(--gold) 0%, #ffec8b 100%);
            box-shadow: 0 0 15px var(--gold);
        }
        
        .silver {
            background: linear-gradient(135deg, var(--silver) 0%, #e8e8e8 100%);
            box-shadow: 0 0 15px var(--silver);
        }
        
        .bronze {
            background: linear-gradient(135deg, var(--bronze) 0%, #e9b376 100%);
            box-shadow: 0 0 15px var(--bronze);
        }
        
        .other {
            background: linear-gradient(135deg, #4a5568 0%, #718096 100%);
        }
        
        .placement-text {
            font-size: 1.1rem;
            font-weight: 500;
            flex-grow: 1;
        }
        
        .last-updated {
            text-align: center;
            color: #cccccc;
            font-size: 1rem;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            max-width: 1200px;
            margin: 25px auto;
            border: 1px solid var(--miskolc-blue);
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #cccccc;
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            display: block;
            color: #4a5568;
        }
        
        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--miskolc-blue);
        }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #cccccc;
            font-size: 1.3rem;
        }
        
        .loading::after {
            content: "";
            animation: dots 1.5s steps(5, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: "."; }
            40% { content: ".."; }
            60%, 100% { content: "..."; }
        }
        
        /* G√∂rget≈ës√°v st√≠lusok */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1a1a2e;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--miskolc-blue);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #1565c0;
        }
        
        /* Anim√°ci√≥ az √∫j eredm√©nyekhez */
        @keyframes highlight {
            0% { 
                background-color: rgba(30, 136, 229, 0.3);
                transform: scale(1.02);
            }
            100% { 
                background-color: transparent;
                transform: scale(1);
            }
        }
        
        .new-result {
            animation: highlight 2s ease;
        }
        
        /* Fullscreen t√°mogat√°s */
        .fullscreen-btn {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: var(--miskolc-blue);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            z-index: 100;
            transition: all 0.3s ease;
        }
        
        .fullscreen-btn:hover {
            background: var(--miskolc-red);
            transform: scale(1.1);
        }
        
        /* Miskolc v√°ros sz√≠nei */
        .miskolc-theme {
            background: linear-gradient(135deg, var(--miskolc-blue) 0%, #0d47a1 100%);
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #cccccc;
            font-size: 0.9rem;
            margin-top: 30px;
            border-top: 1px solid var(--miskolc-blue);
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">2025 Miskolci √ösz√≥verseny</div>
        <div class="year">Miskolc, 2025</div>
        <div class="live-indicator">√âL≈ê EREDM√âNYK√ñVET√âS</div>
    </div>
    
    <div class="stats-bar">
        <div class="stat-item">
            <div class="stat-value" id="total-swimmers">0</div>
            <div class="stat-label">Versenyz≈ë</div>
        </div>
        <div class="stat-item">
            <div class="stat-value" id="total-placements">0</div>
            <div class="stat-label">Helyez√©s</div>
        </div>
        <div class="stat-item">
            <div class="stat-value" id="total-events">0</div>
            <div class="stat-label">Versenysz√°m</div>
        </div>
    </div>
    
    <div class="container" id="results-container">
        <div class="loading">Eredm√©nyek bet√∂lt√©se</div>
    </div>
    
    <div class="last-updated" id="last-updated">
        Utols√≥ friss√≠t√©s: -
    </div>
    
    <div class="footer">
        2025 Miskolci √ösz√≥verseny
    </div>
    
    <button class="fullscreen-btn" id="fullscreen-btn" title="Teljes k√©perny≈ë">‚õ∂</button>

    <script>
        // Firebase konfigur√°ci√≥
        const firebaseConfig = {
            apiKey: "AIzaSyDTvbas3_caFWVc4aMN8C4KbZu7g5r6vfI",
            authDomain: "kmkadmin-86cf5.firebaseapp.com",
            databaseURL: "https://kmkadmin-86cf5-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "kmkadmin-86cf5",
            storageBucket: "kmkadmin-86cf5.appspot.com",
            messagingSenderId: "543581792942",
            appId: "1:543581792942:web:960836303ece5d5fc09b3f",
            measurementId: "G-7JST1C8QQN"
        };

        // Firebase inicializ√°l√°sa
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // Adatok t√°rol√°sa
        let swimmers = [];
        let events = [];
        let placements = [];
        let lastUpdateTime = null;
        
        // DOM elemek
        const resultsContainer = document.getElementById('results-container');
        const totalSwimmersElem = document.getElementById('total-swimmers');
        const totalPlacementsElem = document.getElementById('total-placements');
        const totalEventsElem = document.getElementById('total-events');
        const lastUpdatedElem = document.getElementById('last-updated');
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        
        // Utols√≥ friss√≠t√©s id≈ëpontj√°nak be√°ll√≠t√°sa
        function updateLastUpdated() {
            const now = new Date();
            lastUpdateTime = now;
            const options = { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit',
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            };
            lastUpdatedElem.textContent = `Utols√≥ friss√≠t√©s: ${now.toLocaleDateString('hu-HU', options)}`;
        }
        
        // Teljes k√©perny≈ë funkci√≥
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log(`Fullscreen hiba: ${err.message}`);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }
        
        // √ösz√≥k bet√∂lt√©se Firestore-b√≥l
        function loadSwimmers() {
            db.collection("swimmers").orderBy("name").onSnapshot((snapshot) => {
                swimmers = [];
                snapshot.forEach((doc) => {
                    swimmers.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                updateStats();
                updateLastUpdated();
            }, (error) => {
                console.error("Hiba az √∫sz√≥k bet√∂lt√©sekor: ", error);
            });
        }
        
        // Versenysz√°mok bet√∂lt√©se Firestore-b√≥l
        function loadEvents() {
            db.collection("events").orderBy("name").onSnapshot((snapshot) => {
                events = [];
                snapshot.forEach((doc) => {
                    events.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                updateStats();
            }, (error) => {
                console.error("Hiba a versenysz√°mok bet√∂lt√©sekor: ", error);
            });
        }
        
        // Helyez√©sek bet√∂lt√©se Firestore-b√≥l
        function loadPlacements() {
            db.collection("placements").orderBy("timestamp", "desc").onSnapshot((snapshot) => {
                placements = [];
                snapshot.forEach((doc) => {
                    placements.push({
                        id: doc.id,
                        ...doc.data(),
                        isNew: lastUpdateTime && doc.data().timestamp?.toDate() > lastUpdateTime
                    });
                });
                
                updateResults();
                updateStats();
                updateLastUpdated();
            }, (error) => {
                console.error("Hiba a helyez√©sek bet√∂lt√©sekor: ", error);
            });
        }
        
        // Eredm√©nyek friss√≠t√©se
        function updateResults() {
            // Csoportos√≠t√°s √∫sz√≥nk√©nt
            const groupedPlacements = {};
            
            placements.forEach(placement => {
                if (!groupedPlacements[placement.swimmerId]) {
                    groupedPlacements[placement.swimmerId] = {
                        name: placement.swimmerName,
                        events: {}
                    };
                }
                
                if (!groupedPlacements[placement.swimmerId].events[placement.eventId]) {
                    groupedPlacements[placement.swimmerId].events[placement.eventId] = {
                        name: placement.eventName,
                        placements: []
                    };
                }
                
                groupedPlacements[placement.swimmerId].events[placement.eventId].placements.push(placement);
            });
            
            // Rendez√©s: el≈ësz√∂r a legjobb helyez√©s, majd n√©v szerint
            const sortedSwimmerIds = Object.keys(groupedPlacements).sort((a, b) => {
                // Az √∂sszes helyez√©sb≈ël a legjobbak kiv√°laszt√°sa
                const allPlacementsA = Object.values(groupedPlacements[a].events)
                    .flatMap(event => event.placements.map(p => p.placement));
                const allPlacementsB = Object.values(groupedPlacements[b].events)
                    .flatMap(event => event.placements.map(p => p.placement));
                
                if (allPlacementsA.length === 0) return 1;
                if (allPlacementsB.length === 0) return -1;
                
                const bestA = Math.min(...allPlacementsA);
                const bestB = Math.min(...allPlacementsB);
                
                if (bestA !== bestB) {
                    return bestA - bestB;
                }
                
                return groupedPlacements[a].name.localeCompare(groupedPlacements[b].name);
            });
            
            // Eredm√©nyek megjelen√≠t√©se
            resultsContainer.innerHTML = '';
            
            if (sortedSwimmerIds.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="empty-state">
                        <i>üèä‚Äç‚ôÇÔ∏è</i>
                        <h3>M√©g nincsenek eredm√©nyek</h3>
                        <p>Az eredm√©nyek itt fognak megjelenni, amint r√∂gz√≠tik ≈ëket</p>
                        <p style="margin-top: 15px; font-size: 0.9rem; color: #999;">2025 Miskolci √ösz√≥verseny</p>
                    </div>
                `;
                return;
            }
            
            sortedSwimmerIds.forEach(swimmerId => {
                const swimmerData = groupedPlacements[swimmerId];
                const swimmerCard = document.createElement('div');
                swimmerCard.className = 'swimmer-card';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'swimmer-name';
                nameDiv.textContent = swimmerData.name;
                swimmerCard.appendChild(nameDiv);
                
                // Versenysz√°mok csoportos√≠t√°sa
                Object.values(swimmerData.events).forEach(eventData => {
                    const eventGroup = document.createElement('div');
                    eventGroup.className = 'event-group';
                    
                    const eventNameDiv = document.createElement('div');
                    eventNameDiv.className = 'event-name';
                    eventNameDiv.textContent = eventData.name;
                    eventGroup.appendChild(eventNameDiv);
                    
                    const placementsDiv = document.createElement('div');
                    placementsDiv.className = 'placement-list';
                    
                    // Helyez√©sek rendez√©se
                    const eventPlacements = eventData.placements
                        .sort((a, b) => a.placement - b.placement);
                    
                    eventPlacements.forEach(placement => {
                        const placementItem = document.createElement('div');
                        placementItem.className = 'placement-item';
                        if (placement.isNew) {
                            placementItem.classList.add('new-result');
                        }
                        
                        const medalDiv = document.createElement('div');
                        medalDiv.className = 'medal';
                        
                        if (placement.placement === 1) {
                            medalDiv.classList.add('gold');
                        } else if (placement.placement === 2) {
                            medalDiv.classList.add('silver');
                        } else if (placement.placement === 3) {
                            medalDiv.classList.add('bronze');
                        } else {
                            medalDiv.classList.add('other');
                        }
                        
                        const placementText = document.createElement('span');
                        placementText.className = 'placement-text';
                        placementText.textContent = `${placement.placement}. helyez√©s`;
                        
                        placementItem.appendChild(medalDiv);
                        placementItem.appendChild(placementText);
                        placementsDiv.appendChild(placementItem);
                    });
                    
                    eventGroup.appendChild(placementsDiv);
                    swimmerCard.appendChild(eventGroup);
                });
                
                resultsContainer.appendChild(swimmerCard);
            });
        }
        
        // Statisztik√°k friss√≠t√©se
        function updateStats() {
            totalSwimmersElem.textContent = swimmers.length;
            totalPlacementsElem.textContent = placements.length;
            totalEventsElem.textContent = events.length;
        }
        
        // Esem√©nykezel≈ëk
        fullscreenBtn.addEventListener('click', toggleFullscreen);
        
        // Automatikus friss√≠t√©s
        function startAutoRefresh() {
            // Friss√≠t√©s minden 5 m√°sodpercben
            setInterval(updateLastUpdated, 5000);
        }
        
        // Inicializ√°l√°s
        loadSwimmers();
        loadEvents();
        loadPlacements();
        startAutoRefresh();
        
        // Oldal bet√∂lt√©sekor
        document.addEventListener('DOMContentLoaded', function() {
            // Automatikus scroll az √∫j eredm√©nyekhez
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                        // √öj elemek lettek hozz√°adva
                        setTimeout(() => {
                            const newElements = document.querySelectorAll('.new-result');
                            if (newElements.length > 0) {
                                newElements[0].scrollIntoView({
                                    behavior: 'smooth',
                                    block: 'center'
                                });
                            }
                        }, 1000);
                    }
                });
            });
            
            observer.observe(resultsContainer, {
                childList: true,
                subtree: true
            });
        });
    </script>
</body>
</html>
